<h1><%= @film.title %> <small>Edit Cast &amp; Crew</small></h1>
<% javascript 'films-edit.js' %>

<% if @film.errors.any? %>
	<div class="alert alert-dismissable alert-danger">
	  <button type="button" class="close" data-dismiss="alert">Ã—</button>
	  <strong>There were errors saving this film:</strong>
			<% @film.errors.full_messages.each do |error| %>
			  <li><%= error %></li>
			<% end %>
		</ul>
	</div>
<% end %>

<div class="row">
	<%= form_for @film, :validate => true do |f| %>

	  <div class="col-md-6">
	  	<h4>Production Staff</h4>
	  	<p class="col-md-offset-1">
	  		Who's helping create your film? Drag and drop to re-order the listings.
	  	</p>

	  	<p class="col-md-offset-1">
		  	<input type="checkbox" name="order_crew" <%= "checked" if @film.crew.detect{|c| c.listing_order != nil} %>> &nbsp;
		  	Use custom ordering below for staff
		  </p>

	  	<table class="table">
	  		<tbody>
					<%= f.fields_for :film_positions, @film.film_positions.crew do |builder| %>
						<%= render 'film_position_fields', :f => builder %>
					<% end %>
				</tbody>
				<tfoot>
					<tr><th><%= link_to_add_fields "+", f, :film_positions %></th></tr>
				</tfoot>
			</table>
	  </div>

	  <div class="col-md-6">
	  	<h4>Cast</h4>
	  	<p class="col-md-offset-1">
	  		Who's starring in your film? Drag and drop to re-order the listings.
	  	</p>

	  	<p class="col-md-offset-1">
		  	<input type="checkbox" name="order_cast" <%= "checked" if @film.cast.detect{|c| c.listing_order != nil} %>> &nbsp;
		  	Use custom ordering below for cast
		  </p>

	  	<table class="table">
	  		<tbody>
					<%= f.fields_for :film_positions, @film.cast do |builder| %>
						<%= render 'film_position_fields', :f => builder %>
					<% end %>
				</tbody>
				<tfoot>
					<tr><th><%= link_to_cast_fields "+", f, :film_positions %></th></tr>
				</tfoot>
			</table>
	  </div>

  <% end %>
</div>
<button type="submit" class="btn btn-primary">Save Changes</button>
<a class="btn btn-default" href="<%= film_dashboard_path(@film) %>">Cancel</a>
<hr />

<div class="row">

	<h4>Auditions</h4>
  <div class="col-md-12">
  	<p>Easily organize cast auditions with the YFA's built-in scheduling, or manage the process on your own.</p>
  	<%= form_for @film, :validate => true, :remote => true do |f| %>
	  	<%= f.check_box :auditions_enabled %>
			<%= f.label :auditions_enabled, "Enable YFA Audition System" %>
		<% end %>
		<div id="aud_enabled_wrapper">
			<% if @film.approved %>
				<%= form_for @film, :validate => true, :remote => true do |f| %>
					<%= f.text_area :aud_info, :class => "required", :placeholder => "Audition Info" %>
				<% end %>
				Create Audition Slots
				<%= form_tag (url_for :controller => 'auditions', :action => 'create'), :validate => false, :remote => true, :class => "datepair auditions" do |f| %>
					<%= text_field_tag :location, "", :placeholder => "Location", :validate => false %>
					<br />
					<div class="row">
						<div class="col-md-3">
							Date: <%= text_field_tag :date, nil, :class => "date", :validate => false %>
						</div>
						<div class="col-md-2">
							Start Time: <%= text_field_tag :start_time, nil, :class => "time start", :validate => false %>
						</div>
					</div>
					<div class="row">
						<div class="col-md-3">
							Slot Length: <%= number_field_tag :duration %>
						</div>
						<div class="col-md-2">
							End Time: <%= text_field_tag :end_time, nil, :class => "time end", :validate => false %>
						</div>
					</div>				
					<%= submit_tag "Create Slots" %>
				<% end %>

				<%= @film.title %>'s Audition Slots
				<div id="audition_slots">
					<%= render :partial => 'auditions/groups', :locals => { :audition_groups => Audition.group_into_blocks(@film.auditions) } %>
				</div>
			<% else %>
				Your film needs to be approved by an admin before you can add audition slots. Check back later!
			<% end %>
		</div>
  </div>

</div>
