<% content_for :head do %>
	<script>
		var film_showtimes = <%= raw @showtime_data.to_json %>;
	</script>
<% end %>

<div class="section-intro">
	Coming soon in <strong>Yale Film Alliance</strong>
	<hr />
</div>

<div class="this_week">
  <% if @rows.detect{|row| !row.empty?} %>
		<% @rows.each do |items| %>
			<% this_class = items.length == 2 ? "span6" : "span4" %>
			<% this_class = "span6 offset3" if items.length == 1 %>

			<div class="row">
			<% items.each do |item| %>
				<div class="<%= this_class %> item">
					<% if item.is_a? Film %>
						<% 
								# OK, you caught me. This is a pseudo-hack. We need to render the front page item twice, once for normal clients, and once for phones
								# The top one is phone-hidden, while the bottom is the one we show on phones, hacked to display more prettily
								# dammit charlie...
							 color_class = item.accent_color ? [item.accent_color] : [cycle("red", "blue","yellow","black","dark_blue","green", "light_blue")] 
							 css_classes = color_class + ['hidden-phone']
						%>
						<%= render :partial => 'shared/film_frontpage', :locals => { :film => item, :row_count => items.length, :css_classes => css_classes.join(' ') } %>
						<% css_classes = color_class + ['visible-phone'] %>
						<%= render :partial => 'shared/film_frontpage_mobile', :locals => { :film => item, :css_classes => css_classes.join(' ') } %>
					<% else %>
						<%= item %>
					<% end %>
				</div>
			<% end %>
			</div>
		<% end %>
	<% else %>
  	<h5 id="no-upcoming" class="aligncenter">There are no films this week.</h5>
	<% end %>
	<div class="row aligncenter">
	  <div class="span12">
  	  <%= link_to "See the Full Calendar", films_path, :id => "full-calendar", :class => "btn btn-light" %>
	  </div>
	</div>
</div>

</div><!-- End of #main -->
<div id="news">

<div class="container">
  <div class="section-intro">
		Yale Film Alliance's <strong>Latest News</strong>
		<hr />
	</div>
  
	<%= render :partial => "news", :collection => @news %>
</div>